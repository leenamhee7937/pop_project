## ì˜¤ë¥˜ë¡œ ìˆ¨ê²¨ë‘ 
import streamlit as st
import pandas as pd
import plotly.express as px

# ì‹œë„ë³„ ìœ„ë„/ê²½ë„ ì •ë³´
region_coords = {
    "ì„œìš¸íŠ¹ë³„ì‹œ": [37.5665, 126.9780],
    "ë¶€ì‚°ê´‘ì—­ì‹œ": [35.1796, 129.0756],
    "ëŒ€êµ¬ê´‘ì—­ì‹œ": [35.8714, 128.6014],
    "ì¸ì²œê´‘ì—­ì‹œ": [37.4563, 126.7052],
    "ê´‘ì£¼ê´‘ì—­ì‹œ": [35.1595, 126.8526],
    "ëŒ€ì „ê´‘ì—­ì‹œ": [36.3504, 127.3845],
    "ìš¸ì‚°ê´‘ì—­ì‹œ": [35.5384, 129.3114],
    "ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ": [36.4801, 127.289],
    "ê²½ê¸°ë„": [37.4138, 127.5183],
    "ê°•ì›ë„": [37.8228, 128.1555],
    "ì¶©ì²­ë¶ë„": [36.6359, 127.4914],
    "ì¶©ì²­ë‚¨ë„": [36.5184, 126.8000],
    "ì „ë¼ë¶ë„": [35.7175, 127.1530],
    "ì „ë¼ë‚¨ë„": [34.8161, 126.4630],
    "ê²½ìƒë¶ë„": [36.4919, 128.8889],
    "ê²½ìƒë‚¨ë„": [35.4606, 128.2132],
    "ì œì£¼íŠ¹ë³„ìì¹˜ë„": [33.4996, 126.5312],
}

# CSV íŒŒì¼ ë¡œë“œ
df = pd.read_csv("2024ë…„_ì—°ë ¹ë³„ì¸êµ¬í˜„í™©.csv", encoding='cp949')

# ì§€ì—­ëª… ì •ë¦¬
df['ì§€ì—­ëª…'] = df['í–‰ì •êµ¬ì—­'].str.extract(r'([\w\s]+)')
df = df[df['ì§€ì—­ëª…'] != 'ì „êµ­']

# ì´ì¸êµ¬ìˆ˜ ìˆ«ìí˜• ë³€í™˜
df['ì´ì¸êµ¬ìˆ˜'] = df['ì´ì¸êµ¬ìˆ˜'].str.replace(',', '').astype(int)

# ìœ„ê²½ë„ ë§¤í•‘
df['lat'] = df['ì§€ì—­ëª…'].map(lambda x: region_coords.get(x, [None, None])[0])
df['lon'] = df['ì§€ì—­ëª…'].map(lambda x: region_coords.get(x, [None, None])[1])

# ì¢Œí‘œ ëˆ„ë½ëœ í–‰ ì œê±°
df_map = df.dropna(subset=["lat", "lon"])

# (ì„ íƒ) ë²„ë¸”ì´ ë“¤ì–´ê°ˆ ë°ì´í„° í™•ì¸ìš©
# st.dataframe(df_map[['ì§€ì—­ëª…', 'ì´ì¸êµ¬ìˆ˜', 'lat', 'lon']])

# ì§€ë„ ì‹œê°í™”
fig = px.scatter_mapbox(
    df_map,
    lat='lat',
    lon='lon',
    size='ì´ì¸êµ¬ìˆ˜',
    color='ì´ì¸êµ¬ìˆ˜',
    color_continuous_scale='YlOrRd',
    hover_name='ì§€ì—­ëª…',
    hover_data={'ì´ì¸êµ¬ìˆ˜': True, 'lat': False, 'lon': False},
    size_max=60,
    zoom=5.5,
    center={"lat": 36.5, "lon": 127.8},
    mapbox_style='open-street-map',
    title='ğŸ—ºï¸ 2024ë…„ ì‹œë„ë³„ ì´ì¸êµ¬ìˆ˜ (ë²„ë¸” ì§€ë„)'
)

# ì¶œë ¥
st.title("ğŸ—ºï¸ 2024ë…„ ì‹œë„ë³„ ì´ì¸êµ¬ìˆ˜ ë²„ë¸” ì°¨íŠ¸ ì§€ë„")
st.plotly_chart(fig, use_container_width=True)
